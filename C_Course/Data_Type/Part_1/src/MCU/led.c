/////////////////////////////////////////////////////////////////////////
///	\file led.c
///	\brief this is the LED hardware interface layer.
///
///	Author: Ronald Sousa (@Opticalworm)
/////////////////////////////////////////////////////////////////////////
#include "MCU/led.h"

/////////////////////////////////////////////////////////////////////////
///	\brief defines the LED pin number
/////////////////////////////////////////////////////////////////////////
#define LED_PIN	5

/////////////////////////////////////////////////////////////////////////
///	\brief	Turns on the LED
/////////////////////////////////////////////////////////////////////////
void Led_On(void)
{
	GPIOA->BSRR |= ((uint32_t)1 << LED_PIN);
}

/////////////////////////////////////////////////////////////////////////
///	\brief	Turns off the LED
/////////////////////////////////////////////////////////////////////////
void Led_Off(void)
{
	GPIOA->BRR |= ((uint32_t)1 << LED_PIN);
}

/////////////////////////////////////////////////////////////////////////
/// \brief  Toggle the LED state
/////////////////////////////////////////////////////////////////////////
void Led_Toggle(void)
{
    // read the IO state. if set the turn the led off else turn it on
    if(GPIOA->ODR & (1<<LED_PIN))
    {
        Led_Off();
    }
    else
    {
        Led_On();
    }
}
/////////////////////////////////////////////////////////////////////////
///	\brief	Setup the LED IO
/////////////////////////////////////////////////////////////////////////
void Led_Init(void)
{
	RCC->AHBENR |= ((uint32_t)1<<17); // enable port A clock

	// configure port
	GPIOA->MODER  &= ~((uint32_t)0x3 << 10);    // clear the related bits before we set them. Comment the next call will set all bits.
	GPIOA->MODER |= ((uint32_t)1 << 10); 	// the pin as output
	GPIOA->OTYPER &= ~((uint32_t)1 << 5); 	// set it to push-pull
	GPIOA->OSPEEDR |= ((uint32_t)3 << 10);	// set to 50Mhz
	GPIOA->PUPDR &= ~((uint32_t)2 << 10);	// no pull up/down resistor

	Led_Off();
}
